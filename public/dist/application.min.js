"use strict";function template(tmpl,context,filter){return tmpl.replace(/\{([^\}]+)\}/g,function(m,key){return key in context?filter?filter(context[key]):context[key]:m})}var ApplicationConfiguration=function(){var applicationModuleName="trollozans",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","ui.select2","restangular","cgBusy"],registerModule=function(moduleName){angular.module(moduleName,[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("admin"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("poems"),ApplicationConfiguration.registerModule("topics"),ApplicationConfiguration.registerModule("users"),angular.module("admin").config(["$stateProvider",function($stateProvider){$stateProvider.state("listTopics",{url:"/admin/topics",templateUrl:"modules/admin/views/list-topics.client.view.html"}).state("createTopic",{url:"/admin/topics/create",templateUrl:"modules/admin/views/create-topic.client.view.html"}).state("viewTopic",{url:"/admin/topics/:topicId",templateUrl:"modules/admin/views/view-topic.client.view.html"}).state("editTopic",{url:"/admin/topics/:topicId/edit",templateUrl:"modules/admin/views/edit-topic.client.view.html"}).state("listPoems",{url:"/admin/poems",templateUrl:"modules/admin/views/list-poems.client.view.html"})}]),angular.module("admin").controller("AdminController",["$scope","$stateParams","$location","Authentication","Admin","Poems","Constants",function($scope,$stateParams,$location,Authentication,Admin,Poems,Constants){$scope.authentication=Authentication,$scope.findTopics=function(){$scope.topics=Admin.one("topics").getList().$object},$scope.findOne=function(){Admin.one("topics",$stateParams.topicId).get().then(function(topic){topic.content.type=Constants.convertToSelect2(topic.content.type,"contentTypes"),$scope.topic=topic})},$scope.contentTypeOptions={placeholder:"Select Content Type",data:Constants.createSelect2Data("contentTypes")},$scope.create=function(){this.topic.content.type=Constants.convertFromSelect2(this.topic.content.type),Admin.post(this.topic).then(function(response){$location.path("topics/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message}),this.topic={}},$scope.update=function(){var topic=$scope.topic;topic.content.type=Constants.convertFromSelect2(topic.content.type),delete topic.poems,topic.save().then(function(){$location.path("topics/"+topic._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.findUnapprovedPoems=function(){$scope.poemPromise=Poems.one("waitingForApproval").getList(),$scope.poemPromise.then(function(poems){$scope.poems=poems})},$scope.approvePoem=function(poem,index){$scope.poemPromise=Poems.one("approve").one(poem._id).put(),$scope.poemPromise.then(function(){$scope.poems.splice(index,1)})}}]),angular.module("admin").factory("Admin",["Restangular",function(Restangular){return Restangular.one("admin")}]),angular.module("core").config(["RestangularProvider",function(RestangularProvider){RestangularProvider.setRestangularFields({id:"_id"}),RestangularProvider.setDefaultRequestParams("jsonp",{callback:"JSON_CALLBACK"})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/topics"),$stateProvider.state("home",{url:"/",templateUrl:"modules/topics/views/main-topics.client.view.html"})}]),angular.module("core").run(["uiSelect2Config",function(uiSelect2Config){uiSelect2Config.initSelection=function(){},uiSelect2Config.placeholder="Please Select",uiSelect2Config.multiple=!1}]),angular.module("core").controller("FooterController",["$scope","Topics",function($scope,Topics){$scope.findPopularTopics=function(){$scope.topics=Topics.popularTopics()}}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus","Topics",function($scope,Authentication,Menus,Topics){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1}),$scope.findPopularTopics=function(){$scope.topics=Topics.popularTopics()}}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("topics").directive("bindUnsafeHtml",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.bindUnsafeHtml)},function(value){element.html(value),$compile(element.contents())(scope)})}}]),angular.module("core").directive("likeButton",function(){return{template:'<div data-ng-if="user"><a class="btn btn-primary btn-xs backcolor" data-ng-click="like()" data-ng-if="!_canLike()"><i class="fa fa-thumbs-up"></i>Like</a><a class="btn btn-primary btn-xs backcolor" data-ng-click="unlike()" data-ng-if="_canLike()"><i class="fa fa-thumbs-down"></i>Unlike</a></div><div data-ng-if="!user"><a class="btn btn-primary btn-xs backcolor" href="/#!/signin"><i class="fa fa-thumbs-up"></i>Like</a></div>',scope:{likeArray:"=",user:"=",like:"&",unlike:"&"},replace:!1,restrict:"EA",link:function($scope){$scope._canLike=function(){return _.contains($scope.likeArray,$scope.user._id)}}}}),angular.module("core").directive("ngSocialButtons",["$compile","$q","$parse","$http",function(){return{restrict:"A",scope:{url:"=",title:"=",description:"=",image:"="},replace:!0,transclude:!0,template:"<ul ng-transclude></ul>",controller:["$scope","$q","$http",function($scope,$q,$http){var ctrl={init:function(scope,element,options){options.counter&&ctrl.getCount(scope.options).then(function(count){scope.count=count})},link:function(options){options=options||{};var urlOptions=options.urlOptions||{};return urlOptions.url=$scope.url,urlOptions.title=$scope.title,urlOptions.image=$scope.image,urlOptions.description=$scope.description||"",ctrl.makeUrl(options.clickUrl||options.popup.url,urlOptions)},clickShare:function(e,options){if(!e.shiftKey&&!e.ctrlKey){e.preventDefault();var process=!0;if(angular.isFunction(options.click)&&(process=options.click.call(this,options)),process){var url=ctrl.link(options);ctrl.openPopup(url,options.popup)}}},openPopup:function(url,params){var left=Math.round(screen.width/2-params.width/2),top=0;screen.height>params.height&&(top=Math.round(screen.height/3-params.height/2));var win=window.open(url,"sl_"+this.service,"left="+left+",top="+top+",width="+params.width+",height="+params.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");win?win.focus():location.href=url},getCount:function(options){var def=$q.defer(),urlOptions=options.urlOptions||{};urlOptions.url=$scope.url,urlOptions.title=$scope.title;var url=ctrl.makeUrl(options.counter.url,urlOptions);return options.counter.get?options.counter.get(url,def,$http):$http.jsonp(url).success(function(res){def.resolve(options.counter.getNumber?options.counter.getNumber(res):res)}),def.promise},makeUrl:function(url,context){return template(url,context,encodeURIComponent)}};return ctrl}]}}]),angular.module("core").directive("ngSocialFacebook",function(){var options={counter:{url:"http://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=JSON_CALLBACK",getNumber:function(data){return data.data[0].total_count}},popup:{url:"https://www.facebook.com/dialog/feed?app_id=145634995501895&display=popup&caption=An%20example%20caption&link=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fdialogs%2F&redirect_uri=https://developers.facebook.com/tools/explorer",width:600,height:500}};return{restrict:"C",require:"^?ngSocialButtons",scope:!0,replace:!0,transclude:!0,template:'<li class="facebook"><i class="fa fa-facebook"></i><div class="shaingstats"><h5>{{count}}</h5><p>Shares</p></div><a ng-href="{{ctrl.link(options)}}" target="_blank" ng-click="ctrl.clickShare($event, options)" class="link"></a></li>',controller:["$scope",function(){}],link:function(scope,element,attrs,ctrl){element.addClass("ng-social-facebook"),ctrl&&(scope.options=options,scope.ctrl=ctrl,ctrl.init(scope,element,options))}}}),angular.module("core").directive("ngSocialTwitter",function(){var options={counter:{url:"http://urls.api.twitter.com/1/urls/count.json?url={url}&callback=JSON_CALLBACK",getNumber:function(data){return data.count}},popup:{url:"http://twitter.com/intent/tweet?url={url}&text={title}&related=trollozans&via=trollozans",width:600,height:450},click:function(options){return/[\.:\-–—]\s*$/.test(options.pageTitle)||(options.pageTitle+=":"),!0}};return{restrict:"C",require:"^?ngSocialButtons",scope:!0,replace:!0,transclude:!0,template:'<li class="twitter"><i class="fa fa-twitter"></i><div class="shaingstats"><h5>{{count}}</h5><p>Tweets</p></div><a ng-href="{{ctrl.link(options)}}" target="_blank" ng-click="ctrl.clickShare($event, options)" class="link"></a></li>',controller:["$scope",function(){}],link:function(scope,element,attrs,ctrl){element.addClass("ng-social-twitter"),ctrl&&(scope.options=options,scope.ctrl=ctrl,ctrl.init(scope,element,options))}}}),angular.module("core").directive("stickyNav",[function(){return{restrict:"EA",link:function(){var s=jQuery(".stickynav"),pos=s.position();jQuery(window).scroll(function(){var windowpos=jQuery(window).scrollTop();windowpos>=pos.top?s.addClass("stick"):s.removeClass("stick")})}}}]),angular.module("core").service("Constants",[function(){this.contentTypes={image:"Image",youtube:"Youtube",dailymotion:"Daily Motion"},this.createSelect2Data=function(reference){var data=[];return this[reference]?(angular.forEach(this[reference],function(value,key){data.push({id:key,text:value})}),data):(console.error("No object with given reference"),data)},this.convertFromSelect2=function(object,key){key=key||"id";var result;return angular.isArray(object)?(result=[],angular.forEach(object,function(value){result.push(value[key])}),result):angular.isObject(object)?result=object[key]:void 0},this.convertToSelect2=function(value,reference){return this[reference]&&this[reference][value]?{id:value,text:this[reference][value]}:(console.error("No object with given reference or given key"),value)}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:isPublic||this.menus[menuId].isPublic,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:isPublic||this.menus[menuId].isPublic,roles:roles||this.defaultRoles,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",!1,["author","admin"])}]),angular.module("poems").run(["Menus",function(){}]),angular.module("poems").config(["$stateProvider",function($stateProvider){$stateProvider.state("createPoem",{url:"/poems/create",templateUrl:"modules/poems/views/create-poem.client.view.html"}).state("viewPoem",{url:"/poems/:poemId",templateUrl:"modules/poems/views/view-poem.client.view.html"}).state("editPoem",{url:"/poems/:poemId/edit",templateUrl:"modules/poems/views/edit-poem.client.view.html"})}]),angular.module("poems").controller("PoemsController",["$scope","$stateParams","$location","Authentication","Poems",function($scope,$stateParams,$location,Authentication,Poems){$scope.authentication=Authentication,$scope.create=function(){var poem=new Poems({content:this.content,topic:this.topic,title:this.title,tags:[this.tag]});poem.$save(function(response){$location.path("poems/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message}),this.content="",this.topic="",this.title="",this.tag=""},$scope.remove=function(){$scope.poem.$remove(function(){$location.path("poems")})},$scope.update=function(){var poem=$scope.poem;poem.$update(function(){$location.path("poems/"+poem._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.poems=Poems.query()},$scope.findOne=function(){$scope.poem=Poems.one($stateParams.poemId).get().$object},$scope.findUnapprovedPoems=function(){$scope.poemPromise=Poems.one("waitingForApproval").getList(),$scope.poemPromise.then(function(poems){$scope.poems=poems})},$scope.approvePoem=function(poem,index){$scope.poemPromise=Poems.one("approve").one(poem._id).put(),$scope.poemPromise.then(function(){$scope.poems.splice(index,1)})}}]),angular.module("topics").factory("Poems",["Restangular",function(Restangular){return Restangular.service("poems")}]),angular.module("topics").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Admin-Topics","admin/topics","button","/admin/topics",!1,["author","admin"]),Menus.addMenuItem("topbar","Admin-Poems","admin/poems","button","/admin/poems",!1,["author","admin"]),Menus.addMenuItem("topbar","Topics","topics","button","/topics",!0)}]),angular.module("topics").config(["$stateProvider",function($stateProvider){$stateProvider.state("mainTopics",{url:"/topics",templateUrl:"modules/topics/views/main-topics.client.view.html"}).state("detail-topic",{url:"/topics/:topicId",templateUrl:"modules/topics/views/detail-topic.client.view.html"})}]),angular.module("topics").controller("DetailTopicController",["$scope","$stateParams","$location","Authentication","UserProfile","Topics","Poems",function($scope,$stateParams,$location,Authentication,UserProfile,Topics){$scope.authentication=Authentication,$scope.userProfile=UserProfile,$scope.findTopic=function(){$scope.topicPromise=Topics.findTopic($stateParams.topicId),$scope.topicPromise.then(function(topic){$scope.topic=topic})},$scope.likeTopic=function(topic){Topics.likeTopic(topic._id),topic.usersLiked.push($scope.authentication.user._id)},$scope.unlikeTopic=function(topic){Topics.unlikeTopic(topic._id),topic.usersLiked=_.without(topic.usersLiked,$scope.authentication.user._id)},$scope.findPoems=function(){$scope.poems=Topics.findTopicPoems($stateParams.topicId).$object},$scope.createPoem=function(){$scope.topicPromise=Topics.createTopicPoem($stateParams.topicId,this.poem),$scope.topicPromise.then(function(response){console.log(response),alert("Your poem posted successfully...")},function(errorResponse){$scope.error=errorResponse.data.message}),this.poem={}}}]),angular.module("topics").controller("MainTopicsController",["$scope","$stateParams","$location","Authentication","UserProfile","Topics",function($scope,$stateParams,$location,Authentication,UserProfile,Topics){$scope.authentication=Authentication,$scope.userProfile=UserProfile,$scope.init=function(){$scope.topics=[],$scope.findTopics(0,5)},$scope.findTopics=function(start,offset){var query={start:start,offset:offset};$scope.topicsPromise=Topics.findTopics(query),$scope.topicsPromise.then(function(topics){$scope.topics=$scope.topics.concat(topics)})},$scope.likeTopic=function(topic){Topics.likeTopic(topic._id),topic.usersLiked.push($scope.authentication.user._id)},$scope.unlikeTopic=function(topic){Topics.unlikeTopic(topic._id),topic.usersLiked=_.without(topic.usersLiked,$scope.authentication.user._id)}}]),angular.module("topics").controller("TopicsController",["$scope","$stateParams","$location","Authentication","Topics","Poems","Constants",function($scope,$stateParams,$location,Authentication,Topics,Poems,Constants){$scope.authentication=Authentication,$scope.createPoem=function(topicId){this.poem.topic=topicId,console.log(topicId),Topics.one("poems").all(topicId).post(this.poem).then(function(response){console.log(response)},function(errorResponse){$scope.error=errorResponse.data.message}),this.poem={}},$scope.remove=function(){$scope.topic.remove().then(function(){$location.path("topics")})},$scope.update=function(){var topic=$scope.topic;topic.content.type=Constants.convertFromSelect2(topic.content.type),topic.put().then(function(){$location.path("topics/"+topic._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.topics=Topics.getList().$object},$scope.findPoems=function(index){Topics.one("poems").one($scope.topics[index]._id).get().then(function(topic){console.log(topic.poems),$scope.poems=topic.poems})},$scope.setCurrentTopic=function(index){$scope.currentTopic=index},$scope.getFullTopic=function(){Topics.one("full").one($stateParams.topicId).get().then(function(topic){console.log(topic),$scope.topic=topic})},$scope.contentTypeOptions={placeholder:"Select Content Type",data:Constants.createSelect2Data("contentTypes")}}]),angular.module("topics").directive("contentBox",function(){function getSource(type,reference){return"youtube"===type?"http://img.youtube.com/vi/"+reference+"/0.jpg":"dailymotion"===type?"http://www.dailymotion.com/thumbnail/video/"+reference:"image"===type?reference:void 0}return{templateUrl:"modules/topics/views/templates/contentBox-topic.client.view.html",scope:{topic:"=",user:"=",like:"&",unlike:"&"},replace:!0,restrict:"EA",link:function($scope){$scope.thumbnailSrc=getSource($scope.topic.content.type,$scope.topic.content.reference)}}}),angular.module("topics").directive("contentMenuBox",function(){function getSource(type,reference){return"youtube"===type?"http://img.youtube.com/vi/"+reference+"/0.jpg":"dailymotion"===type?"http://www.dailymotion.com/thumbnail/video/"+reference:"image"===type?reference:void 0}return{templateUrl:"modules/topics/views/templates/contentMenuBox-topic.client.view.html",scope:{topic:"="},replace:!0,restrict:"EA",link:function($scope){$scope.thumbnailSrc=getSource($scope.topic.content.type,$scope.topic.content.reference)}}}),angular.module("topics").directive("contentWrapper",["$sce","$location",function($sce,$location){function getSource(content){return"youtube"===content.type?"//www.youtube-nocookie.com/embed/"+content.reference+"?rel=0":"dailymotion"===content.type?"//www.dailymotion.com/embed/video/"+content.reference+"?logo=0&info=0":void 0}function getImgSource(content){return"youtube"===content.type?"http://img.youtube.com/vi/"+content.reference+"/0.jpg":"dailymotion"===content.type?"http://www.dailymotion.com/thumbnail/video/"+content.reference:"image"===content.type?content.reference:void 0}return{templateUrl:"modules/topics/views/templates/contentWrapper-topic.client.view.html",scope:{topic:"=",user:"=",like:"&",unlike:"&"},replace:!0,restrict:"EA",link:function($scope,iElm,iAttrs){var topicWatcher=$scope.$watch("topic",function(topic){topic&&($scope.iframeSrc=$sce.trustAsResourceUrl(getSource($scope.topic.content)),angular.isUndefined(iAttrs.editable)&&topicWatcher())});$scope.pageUrl=$location.absUrl(),$scope.imgUrl=getImgSource($scope.topic.content)}}}]),angular.module("topics").factory("Topics",["Restangular",function(Restangular){var popularTopics,TopicService={createTopic:function(topic){return Restangular.service("topics").post(topic)},findTopics:function(query){return Restangular.service("topics").getList(query)},findTopic:function(topicId){return Restangular.service("topics").one(topicId).get()},likeTopic:function(topicId){return Restangular.service("topics/like").one(topicId).put()},unlikeTopic:function(topicId){return Restangular.service("topics/unlike").one(topicId).put()},findTopicPoems:function(topicId){return Restangular.service("topics/poems").one(topicId).getList()},createTopicPoem:function(topicId,poem){return Restangular.service("topics/poems/"+topicId).post(poem)},popularTopics:function(){return popularTopics?popularTopics:popularTopics=this.findTopics({start:0,offset:6}).$object}};return TopicService}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/signin.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("UserProfile",function(){return{getUserProfileImageSrc:function(user){return user.additionalProvidersData?user.additionalProvidersData.facebook?"http://graph.facebook.com/"+user.additionalProvidersData.facebook.id+"/picture?type=square":user.additionalProvidersData.twitter?user.additionalProvidersData.twitter.profile_image_url:user.additionalProvidersData.google?user.additionalProvidersData.google.picture:void 0:"/modules/users/img/user.jpg"}}}),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);